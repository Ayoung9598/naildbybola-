# Production Deployment Guide

## üöÄ Next Steps for Production Deployment

Now that everything works locally, follow these steps to deploy to production on Render.com:

---

## üìã Pre-Deployment Checklist

### ‚úÖ 1. Code is Ready
- [x] All features tested locally
- [x] Email templates fixed and working
- [x] Database migrations created and tested
- [x] Environment variables configured in `.env`

### ‚úÖ 2. Security Check
- [x] `.env` file is in `.gitignore` (‚úÖ Already done)
- [x] No hardcoded credentials in code
- [x] Production settings configured

---

## üîß Step-by-Step Deployment

### Step 1: Update `render.yaml` with Email Configuration

The `render.yaml` file needs email environment variables added. Update the backend service section:

```yaml
# Django Backend
- type: web
  name: naildbybola-backend
  env: docker
  plan: free
  dockerfilePath: ./backend/Dockerfile
  envVars:
    - key: DEBUG
      value: False
    - key: DJANGO_SETTINGS_MODULE
      value: config.settings.prod
    - key: SECRET_KEY
      generateValue: true
    # ... existing DB vars ...
    # ADD THESE EMAIL VARIABLES:
    - key: EMAIL_HOST
      value: smtp.gmail.com  # Or your email provider
    - key: EMAIL_PORT
      value: "587"
    - key: EMAIL_USE_TLS
      value: "True"
    - key: EMAIL_HOST_USER
      sync: false  # Set manually in Render Dashboard
    - key: EMAIL_HOST_PASSWORD
      sync: false  # Set manually in Render Dashboard (Gmail App Password)
    - key: DEFAULT_FROM_EMAIL
      sync: false  # Set manually in Render Dashboard
```

### Step 2: Update Backend Dockerfile for Production

The backend Dockerfile should use Gunicorn instead of `runserver` for production:

**Current Dockerfile uses:** `CMD ["python", "manage.py", "runserver", "0.0.0.0:8000"]`

**Should be:** `CMD ["gunicorn", "config.wsgi:application", "--bind", "0.0.0.0:8000"]`

**Note:** Render.yaml already specifies this in `startCommand`, so this should work.

### Step 3: Get Gmail App Password (if using Gmail)

1. Go to your Google Account settings
2. Enable 2-Factor Authentication
3. Go to "App passwords"
4. Generate a new app password for "Mail"
5. Copy the 16-character password
6. Use this in `EMAIL_HOST_PASSWORD` in Render

### Step 4: Push Code to GitHub

```bash
# Make sure .env is in .gitignore (already done)
git add .
git commit -m "Ready for production deployment"
git push origin main
```

### Step 5: Deploy to Render.com

#### Option A: Using Render Dashboard (Recommended)

1. **Go to Render Dashboard**: https://dashboard.render.com
2. **Connect GitHub Repository**
   - Click "New +" ‚Üí "Blueprint"
   - Select your repository
   - Render will auto-detect `render.yaml`
3. **Review Services**
   - PostgreSQL Database (naildbybola-db)
   - Django Backend (naildbybola-backend)
   - React Frontend (naildbybola)
4. **Add Environment Variables** (if not in render.yaml)
   - Go to each service ‚Üí Environment tab
   - Add email variables manually if needed
5. **Deploy**
   - Click "Apply" to deploy all services

#### Option B: Using Render CLI

```bash
# Install Render CLI
npm install -g render-cli

# Login
render login

# Deploy
render deploy
```

### Step 6: Configure Database

After deployment:

1. **Database will be created automatically** (via render.yaml)
2. **Run migrations manually** (if needed):
   - Go to backend service ‚Üí Shell
   - Run: `python manage.py migrate`
   - Run: `python manage.py createsuperuser` (for admin access)

### Step 7: Configure Static Files & Media

Static files should be served automatically via WhiteNoise (already configured).

For media files (images):
- Render free tier doesn't support persistent volumes
- Consider using **Cloudinary** or **AWS S3** for image storage
- Or upgrade to a paid Render plan with persistent disks

### Step 8: Update Admin URLs in Email Templates

The email templates reference admin URLs. These should already use Render URLs:
- `booking_notification.html`: ‚úÖ Uses `naildbybola-backend.onrender.com`
- `contact_notification.html`: ‚úÖ Uses `naildbybola-backend.onrender.com`
- `newsletter_welcome.html`: ‚úÖ Uses `naildbybola.onrender.com`

### Step 9: Test Production Deployment

1. **Frontend**: Visit `https://naildbybola.onrender.com`
2. **Backend API**: Visit `https://naildbybola-backend.onrender.com/api/services/`
3. **Admin Panel**: Visit `https://naildbybola-backend.onrender.com/admin`
4. **Test Features**:
   - Submit a booking
   - Submit contact form
   - Subscribe to newsletter
   - Check if emails are received

---

## üîê Production Environment Variables

Ensure these are set in Render Dashboard for backend service:

### Required Variables:
```
DEBUG=False
DJANGO_SETTINGS_MODULE=config.settings.prod
SECRET_KEY=<auto-generated>
ALLOWED_HOSTS=naildbybola-backend.onrender.com
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=True
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password
DEFAULT_FROM_EMAIL=your-email@gmail.com
```

Database variables are auto-configured via `fromService` in render.yaml.

---

## üêõ Troubleshooting

### Issue: Static files not loading
**Solution**: Ensure `collectstatic` runs in build command (already in render.yaml)

### Issue: Media files lost after restart
**Solution**: Use Cloudinary or S3 for persistent storage (free tier limitation)

### Issue: Emails not sending
**Solution**: 
- Verify Gmail App Password is correct
- Check Render logs for email errors
- Ensure `EMAIL_HOST_USER` matches `DEFAULT_FROM_EMAIL`

### Issue: CORS errors
**Solution**: Verify `CORS_ALLOWED_ORIGINS` in `base.py` includes frontend URL

### Issue: Database connection failed
**Solution**: Check database service is running and variables are correctly linked

---

## üìä Post-Deployment Tasks

1. **Create Admin User**
   ```bash
   # In Render Shell for backend service:
   python manage.py createsuperuser
   ```

2. **Add Initial Content**
   - Services
   - Gallery images
   - Testimonials (if any)

3. **Test All Features**
   - Booking flow
   - Contact form
   - Newsletter subscription
   - Email notifications

4. **Set up Monitoring**
   - Monitor Render dashboard for uptime
   - Check logs regularly
   - Set up error alerts if available

---

## üö® Important Notes

### Render Free Tier - What You Get FREE:

1. **PostgreSQL Database**: 
   - ‚úÖ FREE tier available
   - ‚úÖ 1 GB storage
   - ‚úÖ Automatic backups

2. **Web Services (Backend & Frontend)**:
   - ‚úÖ FREE tier available
   - ‚ö†Ô∏è Services spin down after 15 minutes of inactivity
   - ‚ö†Ô∏è First request after spin-down takes 30-60 seconds to wake up
   - ‚úÖ No traffic limits
   - ‚úÖ SSL/HTTPS included (free)

3. **Docker Containers**:
   - ‚úÖ FREE to build and run on Render
   - ‚úÖ You DON'T need Docker Desktop running locally
   - ‚úÖ Render builds and runs containers on their servers
   - ‚úÖ Your local machine doesn't host anything after deployment

### After Deployment:

- ‚ùå **You DON'T need Docker Desktop running** - Render runs everything
- ‚ùå **You DON'T need your local containers** - They're just for development
- ‚úÖ **Everything runs on Render's servers** - Accessible via the URLs
- ‚úÖ **Your code is in GitHub** - Render pulls from there automatically

2. **Media Files**:
   - Free tier doesn't support persistent volumes
   - Uploaded images will be lost on service restart
   - Use external storage (Cloudinary/S3) for production

3. **Email Service**:
   - Gmail has daily sending limits
   - Consider SendGrid/Mailgun for higher volumes

4. **Security**:
   - Keep `SECRET_KEY` secret
   - Don't commit `.env` file
   - Use HTTPS (Render provides automatically)

---

## üìù Next Steps After Deployment

1. ‚úÖ Deploy to Render
2. ‚úÖ Test all features
3. ‚è≥ Set up custom domain (optional)
4. ‚è≥ Configure CDN for media files (Cloudinary/S3)
5. ‚è≥ Set up automated backups
6. ‚è≥ Monitor performance and errors

---

## üéâ You're Ready!

Your application is production-ready. Follow the steps above to deploy to Render.com.

For questions or issues, check:
- Render Documentation: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/stable/howto/deployment/
- React Deployment: https://create-react-app.dev/docs/deployment/

Good luck with your deployment! üöÄ

